## 简介
### 关于 UAC

**企业级身份与权限管理解决方案**  
为企业/组织提供安全可控的用户管理体系与智能权限中枢，保障业务数据安全的同时，显著提升管理效率。

---

### 一、账号全流程管理体系  
**从入职到离职的闭环管理**  
- 快速完成员工/客户账号创建，支持批量导入与信息自动同步，入职即用  
- 灵活调整账号状态（启用/停用/删除），权限随岗位变动自动更新  
- 多维度组织架构：支持集团多层级架构，智能关联部门与用户分组（如按区域、业务线）  

**便捷的协作管理**  
- 分级管理员机制：总部统一管控策略，分支机构自主管理辖区账号  
- 一键密码重置与安全策略：强制密码强度、定期更换提醒，降低人为风险  

---

### 二、智能安全防护体系  
**多重身份验证保障**  
- 基础登录：账号密码动态加密，杜绝明文传输风险  
- 强化防护：手机验证码/指纹/面部识别等多因素认证，关键操作二次确认  

**风险智能拦截**  
- 异常登录实时预警：识别非常用设备、异地登录等可疑行为  
- 会话安全管控：闲置自动退出、多端登录可视化管理  

---

### 三、智能权限中枢  
**权限精准匹配岗位需求**  
- 角色权限模版：预置销售/财务/管理员等岗位权限包，一键关联  
- 动态权限控制：根据部门、职级等属性自动分配数据查看范围（如仅本部门报表）  
- 细粒度管控：支持控制到具体操作（查看/编辑/导出）甚至数据字段  

**审计与合规保障**  
- 权限变更全程留痕，支持操作记录追溯与定期合规审查  
- 敏感操作审批流程，规避越权风险  

---

### 四、开放扩展能力  
- **无缝集成**：支持与企业微信/钉钉等平台对接，同步组织架构  
- **单点登录(SSO)**：一个账号通行多个业务系统，提升使用体验  
- **API生态**：快速对接HR系统、OA等，实现账号自动化管理  

---

**为您创造的价值**  
✓ **安全降本**：减少90%的账号安全事件与人工管理成本  
✓ **效率提升**：权限分配效率提升60%，新员工10分钟开通全业务权限  
✓ **合规可靠**：满足GDPR等数据安全法规，审计报告一键生成  

---

通过聚焦业务场景的优化表述，能更直观理解产品如何解决实际管理痛点，同时弱化了技术实现细节，强化商业价值呈现。

### 引用链接
1.[CRM系统的用户管理和权限控制功能咋样设计和实现? - 简道云官网](https://www.jiandaoyun.com/blog/article/1795644/)
2.[一套管理软件需要设计哪些功能 | 零代码企业数字化知识站 - 简道云官网](https://www.jiandaoyun.com/blog/article/2282360/)
3.[功能介绍、用户权限、数据权限、系统管理 - JeeSite](https://jeesite.com/docs/function/)
4.[账号管理项目有哪些方面 - Worktile](https://worktile.com/kb/p/3371751)
5.[一文搞定权限管理!授权、鉴权超详细解析 - CSDN博客](https://blog.csdn.net/weixin_43314519/article/details/118365327)
6.[业务系统通用功能包括:企业高效运营的六大核心要素 - 伙伴云](https://www.huoban.com/yx-jiaocheng/PEQnWww6dwX1xbZq.html)
7.[企业权限管理项目有哪些 - Worktile](https://worktile.com/kb/p/3397955)
8.[权限控制入门教程:轻松掌握用户权限管理 - 慕课网](https://www.imooc.com/article/374890)
9.[记者实测 | 智能体按下"加速键" 大厂争当MCP"应用商店" - 东方财富网](https://finance.eastmoney.com/a/202504303394902161.html)
10.[用友erp软件的系统管理功能 - 简道云官网](https://www.jiandaoyun.com/blog/article/1010651/)
11.[erp 安全组用户管理功能有哪些 ERP安全组用户管理核心功能解析 - 简道云官网](https://www.jiandaoyun.com/blog/article/1848945/)
12.[客户权限如何管理 - Worktile](https://worktile.com/kb/p/3725634)
13.[项目中的用户管理包括哪些 - PingCode](https://docs.pingcode.com/ask/ask-ask/439612.html)
14.[后台管理有哪些项目 - "基石协作"织信Informat官网](https://www.informat.cn/qa/224037)
15.[028.[转] 认证、授权、鉴权和权限控制 - 博客园](https://www.cnblogs.com/badboyh2o/p/11068779.html)
16.[生活服务类平台产品研发-账户系统(三户) - 博客园](https://www.cnblogs.com/winyh/p/11355845.html)
17.[后台管理有哪些项目 - PingCode](https://docs.pingcode.com/ask/ask-ask/405011.html)
18.[erp中角色管理包括哪些 - 用友畅捷通](https://www.chanjet.com/lker/652f3567e4b0fdcfa8d9306c.html?c=detail)
19.[设备管理软件中的权限管理与访问控制功能介绍 - 领值设备维护管理系统](https://baijiahao.baidu.com/s?id=1802977306776066199&wfr=spider&for=pc)
20.[ERP的用户管理 ERP用户管理 必备技能:用户画像分析详解 - 用友好业财官网](https://hyc.chanjet.com/hyczg/0d9c1c1aba6fe.html)
21.[erp用户管理功能 - 用友畅捷通](https://www.chanjet.com/lker/652cc59ee4b0fdcff88b4a39.html)
22.[企业权限管理项目包括哪些内容 - PingCode](https://docs.pingcode.com/ask/432122.html)
23.[系统用户管理系统的介绍与优势 - 阿里云创新中心](http://startup.aliyun.com/info/1072463.html)
24.[用户管理项目怎么做的 - Worktile](https://worktile.com/kb/p/3799435)

## 安装
1. 修改配置文件 ./config.json

   配置文件包含以下主要配置项：
   - **postgresql**: 数据库连接配置
     - `host`: 数据库主机地址，默认为 localhost
     - `port`: 数据库端口，默认为 15432
     - `database`: 数据库名称，默认为 UAC
     - `user`: 数据库用户名，默认为 yoyo
     - `password`: 数据库密码，默认为 123456
     - `max_connections`: 最大连接数，默认为 20
     - `idle_timeout`: 空闲连接超时时间（毫秒），默认为 30000
     - `connection_timeout`: 连接超时时间（毫秒），默认为 2000
     - `ssl`: 是否启用 SSL 连接，默认为 false
   - **api**: API 服务配置
     - `port`: API 服务端口，默认为 3000
     - `host`: API 服务主机地址，默认为 localhost
     - `cors`: 跨域配置
       - `origin`: 允许的源地址，默认为 ["http://localhost:3000", "http://localhost:8080"]
       - `methods`: 允许的 HTTP 方法，默认为 ["GET", "POST", "PUT", "DELETE", "PATCH"]
       - `allowedHeaders`: 允许的请求头，默认为 ["Content-Type", "Authorization"]
       - `credentials`: 是否允许携带凭证，默认为 true
       - `maxAge`: 预检请求缓存时间（秒），默认为 86400
     - `rateLimit`: 请求限流配置
       - `windowMs`: 时间窗口（毫秒），默认为 900000
       - `max`: 最大请求数，默认为 100
     - `security`: 安全配置
       - `jwtSecret`: JWT 密钥，默认为 my-jwt-secret-key
       - `jwtExpiresIn`: JWT 过期时间，默认为 24h
       - `bcryptSaltRounds`: bcrypt 加密轮数，默认为 10
   - **logging**: 日志配置
     - `level`: 日志级别，默认为 info
     - `format`: 日志格式，默认为 json
     - `file`: 日志文件路径，默认为 logs/app.log
     - `rotation`: 日志轮转配置
       - `maxSize`: 单个日志文件最大大小，默认为 20m
       - `maxFiles`: 普通日志保留天数，默认为 14d
       - `zippedArchive`: 是否压缩旧日志，默认为 true
       - `errorMaxFiles`: 错误日志保留天数，默认为 30d
       - `exceptionsMaxFiles`: 异常日志保留天数，默认为 30d
       - `rejectionsMaxFiles`: Promise拒绝日志保留天数，默认为 30d

2. 启动
```bash
# 启动服务
npm run dev
```

## 开发
### 部署
```bash
# 启动服务
npm run dev
```

### 调试

```bash
# IMPORTANT: 初始化数据结构， 注意这一步会清空已有数据，如有数据则需跳过
npm run init-db-with-mock

# 检查API服务健康状态
curl -s http://localhost:3000/api/v1/health

# login
curl -v -X POST http://localhost:3000/api/v1/auth/login -H "Content-Type: application/json" -d '{"username":"dept_admin","password":"password123"}'

```


### 测试
#### 注意：
1、如果服务器没有启动、数据库没有连接成功，会给出信息，需手工操作；
2、如果jest遇到缺少表、字段等错误，只给吃错误信息；
3、jest时不会初始化数据库，当会做一些添加和清除测试数据的操作；
4、yarn jest运行时不需要运行 init-db.test.js，需要时需手工单独启动。

#### 常见测试命令：
```bash
# 数据库
yarn jest test/db.test.js

# 部门/组织
yarn jest test/department.test.js

# 用户
yarn jest test/user.test.js

# 权限
yarn jest test/permission.test.js
```

### 数据库表维护操作
数据库表维护操作包括 VACUUM、ANALYZE 和 REINDEX，用于清理死元组、更新统计信息以及重建索引，确保数据库性能。  
可通过以下命令执行维护操作：

```bash
# 执行所有维护操作（VACUUM、ANALYZE、REINDEX）
yarn db:maintenance:all

# 单独执行 VACUUM 操作
yarn db:vacuum

# 单独执行 ANALYZE 操作
yarn db:analyze

# 单独执行 REINDEX 操作
yarn db:reindex
```

维护日志将保存在 `logs` 目录下，文件名格式为 `db-maintenance-YYYYMMDD_HHMMSS.log`。  
如遇权限问题，脚本会输出警告信息，请检查数据库用户权限。

