## 简介
### 关于 UAC 

UAC 由 ( IAM + EMM ) 组成

IAM 系统是 Identity and Access Management（身份识别与访问管理），系统用于管理数字身份、控制用户对资源访问权限的技术框架，核心目标是确保合适的用户在合适的时间，以合适的权限访问合适的资源，同时保障系统和数据的安全性。

EMM 系统是 （企业Media管理），系统用于管理企业的图片、文档、视频等数字化生产资料。

**企业级身份与权限管理解决方案**  
为企业/组织提供安全可控的用户管理体系与智能权限中枢，保障业务数据安全的同时，显著提升管理效率。

---

### 一、账号全流程管理体系  
**从入职到离职的闭环管理**  
- 快速完成员工/客户账号创建，支持批量导入与信息自动同步，入职即用  
- 灵活调整账号状态（启用/停用/删除），权限随岗位变动自动更新  
- 多维度组织架构：支持集团多层级架构，智能关联部门与用户分组（如按区域、业务线）  

**便捷的协作管理**  
- 分级管理员机制：总部统一管控策略，分支机构自主管理辖区账号  
- 一键密码重置与安全策略：强制密码强度、定期更换提醒，降低人为风险  

---

### 二、智能安全防护体系  
**多重身份验证保障**  
- 基础登录：账号密码动态加密，杜绝明文传输风险  
- 强化防护：手机验证码/指纹/面部识别等多因素认证，关键操作二次确认  

**风险智能拦截**  
- 异常登录实时预警：识别非常用设备、异地登录等可疑行为  
- 会话安全管控：闲置自动退出、多端登录可视化管理  

---

### 三、智能权限中枢  
**权限精准匹配岗位需求**  
- 角色权限模版：预置销售/财务/管理员等岗位权限包，一键关联  
- 动态权限控制：根据部门、职级等属性自动分配数据查看范围（如仅本部门报表）  
- 细粒度管控：支持控制到具体操作（查看/编辑/导出）甚至数据字段  

**细粒度权限控制详解**  
1. 数据级别控制
   - 支持控制到具体的数据记录级别
   - 例如：部门主管只能查看本部门的员工信息
   - 通过数据权限规则实现字段级权限控制

2. 操作级别控制
   - 精确控制用户能执行的具体操作
   - 例如：某些用户只能查看数据，不能修改
   - 支持增删改查等基础操作的细粒度控制

3. 资源级别控制
   - 控制用户能访问的具体资源类型
   - 例如：用户只能访问特定的模块或功能
   - 支持多维度资源访问控制

4. 条件控制
   - 支持设置复杂的访问条件
   - 例如：特定时间段访问、特定IP访问等
   - 通过JSON格式的规则配置实现灵活控制

**API使用说明**  
  前端/APP开发人员请参见 [API使用说明](./API使用说明.md)

**审计与合规保障**  
- 权限变更全程留痕，支持操作记录追溯与定期合规审查  
- 敏感操作审批流程，规避越权风险  

---

### 四、开放扩展能力  
- **无缝集成**：支持与企业微信/钉钉等平台对接，同步组织架构  
- **单点登录(SSO)**：一个账号通行多个业务系统，提升使用体验  
- **API生态**：快速对接HR系统、OA等，实现账号自动化管理  

---

**为您创造的价值**  
✓ **安全降本**：减少90%的账号安全事件与人工管理成本  
✓ **效率提升**：权限分配效率提升60%，新员工10分钟开通全业务权限  
✓ **合规可靠**：满足GDPR等数据安全法规，审计报告一键生成  

---

通过聚焦业务场景的优化表述，能更直观理解产品如何解决实际管理痛点，同时弱化了技术实现细节，强化商业价值呈现。

### 引用链接
   本项目引用参考的[链接](./引用链接.md)

## 安装
1. 修改配置文件 ./config.json
   配置内容包括：数据库、API 配置、文件上传配置和日志配置。
   详细的配置说明请参考 [配置文件说明](./config.json.md)

2. 安装数据库
```bash
npm run init-db

# 在安装结束后，会初始化一个超级管理员 admin，验证
curl -X POST http://localhost:3000/api/v1/auth/login -H "Content-Type: application/json" -d '{"username":"admin","password":"123456"}'

# 请在初始化结束后删除超级管理员


```

### 日志使用说明
本项目配置并使用日志系统，[详细说明](./日志使用说明.md)

2. 启动
```bash
# 启动服务
npm run dev
```

## API文档
- Web API 文档  
http://localhost:3000/swagger

- Open API 地址  
http://localhost:3000/swagger.json


## 开发
### 部署
```bash
# 启动服务
yarn dev

# ESLint
yarn lint
```

### git
```bash
# 提交到main分支
git push origin main
```

### 调试

```bash
# IMPORTANT: 初始化数据结构， 注意这一步会清空已有数据，如有数据则需跳过
npm run init-db-with-mock

# 检查API服务健康状态
curl -s http://localhost:3000/api/v1/health

# login
curl -v -X POST http://localhost:3000/api/v1/auth/login -H "Content-Type: application/json" -d '{"username":"dept_admin","password":"password123"}'

```


### 测试
#### 注意：
1、如果服务器没有启动、数据库没有连接成功，会给出信息，需手工操作；
2、如果jest遇到缺少表、字段等错误，只给吃错误信息；
3、jest时不会初始化数据库，当会做一些添加和清除测试数据的操作；
4、yarn jest运行时不需要运行 init-db.test.js，需要时需手工单独启动。

#### 常见测试命令：
```bash
# 数据库
yarn jest test/db.test.js

# 部门/组织
yarn jest test/department.test.js

# 用户
yarn jest test/user.test.js

# 权限
yarn jest test/permission.test.js
```

#### 测试覆盖检查
```bash
# 检查测试覆盖率，生成后会自动创建coverage目录
yarn test --coverage
```
进入coverage目录，打开lcov-report/index.html文件，查看测试覆盖率。
命令行查看： cat coverage/lcov.info

### 数据库表维护操作
数据库表维护操作包括 VACUUM、ANALYZE 和 REINDEX，用于清理死元组、更新统计信息以及重建索引，确保数据库性能。  
可通过以下命令执行维护操作：

```bash
# 执行所有维护操作（VACUUM、ANALYZE、REINDEX）
yarn db:maintenance:all

# 单独执行 VACUUM 操作
yarn db:vacuum

# 单独执行 ANALYZE 操作
yarn db:analyze

# 单独执行 REINDEX 操作
yarn db:reindex
```

